<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlay Test - Debug Version</title>
    <style>
        body {
            margin: 20px;
            background: #1a1a1a;
            color: white;
            font-family: sans-serif;
        }
        .image-container {
            position: relative;
            width: 568px;
            height: 432px;
            margin: 20px auto;
            border: 1px solid #666;
        }
        .base-image, .overlay-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .overlay-image {
            opacity: 0.9;
            z-index: 2;
        }
        .debug-panel {
            background: #2a2a2a;
            border: 1px solid #444;
            margin: 20px auto;
            max-width: 600px;
            padding: 15px;
            border-radius: 5px;
        }
        .debug-section {
            margin-bottom: 10px;
            padding: 10px;
            background: #333;
            border-radius: 3px;
        }
        .debug-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #00aaff;
        }
        .controls {
            text-align: center;
            margin: 20px;
        }
        button {
            padding: 8px 16px;
            margin: 0 5px;
            background: #333;
            color: white;
            border: 1px solid #666;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background: #444;
        }
        pre {
            background: #111;
            padding: 10px;
            overflow: auto;
            max-height: 150px;
            color: #00ff00;
            font-family: monospace;
        }
        #error-message {
            color: #ff5555;
            margin-top: 10px;
            padding: 10px;
            background: #331111;
            border-radius: 3px;
            display: none;
        }
    </style>
</head>
<body>
    <h1 style="text-align:center">Overlay Image Test - Debug Version</h1>

    <div class="controls">
        <button id="toggle-overlay">Toggle Overlay</button>
        <button id="toggle-base">Toggle Base Image</button>
        <button id="check-images">Check Image Status</button>
        <button id="force-reload">Force Reload Images</button>
    </div>

    <div class="image-container">
        <img id="base-image" class="base-image" src="/items/linac.png" alt="Base Image" style="image-rendering: pixelated;">
        <img id="overlay-image" class="overlay-image" src="/items/overlays/gantry_overlay.png" alt="Overlay Image" style="image-rendering: pixelated;">
    </div>

    <div id="error-message"></div>

    <div class="debug-panel">
        <div class="debug-section">
            <div class="debug-title">Image Paths:</div>
            <div>Base Image: <span id="base-path">/items/linac.png</span></div>
            <div>Overlay Image: <span id="overlay-path">/items/overlays/gantry_overlay.png</span></div>
        </div>

        <div class="debug-section">
            <div class="debug-title">Image Status:</div>
            <div>Base Image: <span id="base-status">Checking...</span></div>
            <div>Overlay Image: <span id="overlay-status">Checking...</span></div>
        </div>

        <div class="debug-section">
            <div class="debug-title">Image Properties:</div>
            <div>Base Image Natural Size: <span id="base-dimensions">Checking...</span></div>
            <div>Overlay Image Natural Size: <span id="overlay-dimensions">Checking...</span></div>
        </div>

        <div class="debug-section">
            <div class="debug-title">Log:</div>
            <pre id="log"></pre>
        </div>
    </div>

    <script>
        // Helper functions
        function log(message) {
            const logElem = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElem.textContent = `[${timestamp}] ${message}\n` + logElem.textContent;
        }

        function showError(message) {
            const errorElem = document.getElementById('error-message');
            errorElem.textContent = message;
            errorElem.style.display = 'block';
            log(`ERROR: ${message}`);
        }

        function hideError() {
            document.getElementById('error-message').style.display = 'none';
        }

        // Check image status
        function checkImageStatus() {
            const baseImage = document.getElementById('base-image');
            const overlayImage = document.getElementById('overlay-image');
            
            // Base image status
            document.getElementById('base-status').textContent = 
                baseImage.complete ? (baseImage.naturalWidth === 0 ? 'Failed to load' : 'Loaded') : 'Loading...';
            
            // Overlay image status
            document.getElementById('overlay-status').textContent = 
                overlayImage.complete ? (overlayImage.naturalWidth === 0 ? 'Failed to load' : 'Loaded') : 'Loading...';
            
            // Dimensions
            if (baseImage.complete && baseImage.naturalWidth > 0) {
                document.getElementById('base-dimensions').textContent = 
                    `${baseImage.naturalWidth} × ${baseImage.naturalHeight}`;
            }
            
            if (overlayImage.complete && overlayImage.naturalWidth > 0) {
                document.getElementById('overlay-dimensions').textContent = 
                    `${overlayImage.naturalWidth} × ${overlayImage.naturalHeight}`;
            }
            
            // Log results
            log(`Image status check - Base: ${baseImage.complete ? (baseImage.naturalWidth === 0 ? 'Failed' : 'Success') : 'Loading'}, 
                Overlay: ${overlayImage.complete ? (overlayImage.naturalWidth === 0 ? 'Failed' : 'Success') : 'Loading'}`);
            
            // Show error if overlay failed but base succeeded
            if (baseImage.complete && baseImage.naturalWidth > 0 && 
                overlayImage.complete && overlayImage.naturalWidth === 0) {
                showError("WARNING: Base image loaded successfully, but overlay image failed to load. Check the path and file integrity.");
            } else {
                hideError();
            }
        }

        // Set up initial state
        document.addEventListener('DOMContentLoaded', function() {
            log("Page loaded, checking images...");
            setTimeout(checkImageStatus, 500); // Check after a short delay
        });

        // Check images when they load
        document.getElementById('base-image').onload = function() {
            log("Base image loaded successfully");
            document.getElementById('base-status').textContent = 'Loaded';
            document.getElementById('base-dimensions').textContent = 
                `${this.naturalWidth} × ${this.naturalHeight}`;
        };

        document.getElementById('base-image').onerror = function() {
            log("ERROR: Base image failed to load");
            document.getElementById('base-status').textContent = 'Failed to load';
            showError("Base image failed to load. Check the path and file integrity.");
        };

        document.getElementById('overlay-image').onload = function() {
            log("Overlay image loaded successfully");
            document.getElementById('overlay-status').textContent = 'Loaded';
            document.getElementById('overlay-dimensions').textContent = 
                `${this.naturalWidth} × ${this.naturalHeight}`;
        };

        document.getElementById('overlay-image').onerror = function() {
            log("ERROR: Overlay image failed to load");
            document.getElementById('overlay-status').textContent = 'Failed to load';
            showError("Overlay image failed to load. Check the path and file integrity.");
        };

        // Button handlers
        document.getElementById('toggle-overlay').addEventListener('click', function() {
            const overlayImage = document.getElementById('overlay-image');
            overlayImage.style.display = overlayImage.style.display === 'none' ? 'block' : 'none';
            log(`Overlay display toggled to: ${overlayImage.style.display}`);
        });

        document.getElementById('toggle-base').addEventListener('click', function() {
            const baseImage = document.getElementById('base-image');
            baseImage.style.display = baseImage.style.display === 'none' ? 'block' : 'none';
            log(`Base image display toggled to: ${baseImage.style.display}`);
        });

        document.getElementById('check-images').addEventListener('click', function() {
            log("Manual image status check triggered");
            checkImageStatus();
        });

        document.getElementById('force-reload').addEventListener('click', function() {
            log("Forcing image reload...");
            
            const baseImage = document.getElementById('base-image');
            const overlayImage = document.getElementById('overlay-image');
            
            // Add cache-busting parameter
            const timestamp = new Date().getTime();
            baseImage.src = baseImage.src.split('?')[0] + '?t=' + timestamp;
            overlayImage.src = overlayImage.src.split('?')[0] + '?t=' + timestamp;
            
            // Reset status
            document.getElementById('base-status').textContent = 'Reloading...';
            document.getElementById('overlay-status').textContent = 'Reloading...';
            document.getElementById('base-dimensions').textContent = 'Checking...';
            document.getElementById('overlay-dimensions').textContent = 'Checking...';
            
            hideError();
        });
    </script>
</body>
</html> 